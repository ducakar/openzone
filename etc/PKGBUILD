# Maintainer: Davorin Uƒçakar <davorin.ucakar@gmail.com>

pkgbase=openzone
# pkgname=('liboz' 'openzone' 'openzone-data' 'openzone-doc')
pkgname=('openzone' 'openzone-data' 'openzone-doc')
pkgver=0.2.90
pkgrel=1
url="http://github.com/ducakar/openzone/"
license=('GPL3')
arch=('i686' 'x86_64')
makedepends=('cmake' 'doxygen' 'faad2' 'freeimage' 'gcc' 'git' 'graphviz'
             'libmad' 'lua' 'openal' 'physfs' 'sdl_net' 'sdl_ttf')
source=("openzone-src-${pkgver}.tar.xz"
        "openzone-data-ozbase-${pkgver}.tar.xz"
        "openzone-data-openzone-${pkgver}.tar.xz")
sha1sums=('6d98d4d95530bbbc53f0eae6d804a9b5183f2597'
          '8cbab779654b0c0b2662feb6133b7093c2c51631'
          '425abd0477fc04c15eb57d5367da18663b37470c')

build()
{
  mkdir -p ${srcdir}/build && cd ${srcdir}/build

#   cmake \
#     -D CMAKE_BUILD_TYPE=RelWithDebInfo \
#     -D CMAKE_INSTALL_PREFIX=/usr \
#     -D OZ_SHARED_LIBOZ=ON \
#     ../openzone

  cmake \
    -D CMAKE_BUILD_TYPE=RelWithDebInfo \
    -D CMAKE_INSTALL_PREFIX=/usr \
    -D OZ_SHARED_LIBOZ=OFF \
    ../openzone

  make doc
  make
}

# package_liboz()
# {
#   pkgdesc='OpenZone core library'
#   license=('ZLIB')
#   depends=('physfs')
#   optdepends=('pulseaudio: warning bell')
#
#   cd ${srcdir}/build
#
#   make install DESTDIR=${pkgdir}
#
#   rm -rf ${pkgdir}/usr/bin
#   rm -rf ${pkgdir}/usr/share/{applications,pixmaps}
#
#   if [[ "$CARCH" == "x86_64" ]]; then
#     mv ${pkgdir}/usr/lib64 ${pkgdir}/usr/lib
#     sed 's|/usr/lib64|/usr/lib|g' -i ${pkgdir}/usr/lib/pkgconfig/liboz.pc
#   fi
#
#   mkdir -p ${pkgdir}/usr/share/doc/liboz
#   cp -r ../openzone/doc/doxygen.liboz/html ${pkgdir}/usr/share/doc/liboz/doxygen
#
#   install -Dm644 ../openzone/src/oz/COPYING ${pkgdir}/usr/share/licenses/liboz/COPYING
# }

package_openzone()
{
  pkgdesc='Simple cross-platform FPS/RTS game'
#   depends=('freeimage' 'libgl' 'liboz' 'lua' 'openal' 'sdl_net' 'sdl_ttf')
  depends=('freeimage' 'libgl' 'lua' 'openal' 'physfs' 'sdl_net' 'sdl_ttf')
  optdepends=('pulseaudio: warning bell for liboz'
	      'openzone-data: game data'
              'zip: for building ZIP game data archives'
              'p7zip: for building 7zip game data archives')

  cd ${srcdir}/build

  make install DESTDIR=${pkgdir}

  rm -rf ${pkgdir}/usr/{include,lib,lib64}

  install -Dm644 ../ozbase.zip ${pkgdir}/usr/share/openzone/ozbase.zip
  install -Dm644 ../openzone/AUTHORS ${pkgdir}/usr/share/doc/openzone/AUTHORS
  install -Dm644 ../openzone/ChangeLog ${pkgdir}/usr/share/doc/openzone/ChangeLog
  install -Dm644 ../openzone/BUGS ${pkgdir}/usr/share/doc/openzone/BUGS
  install -Dm644 ../openzone/TODO ${pkgdir}/usr/share/doc/openzone/TODO
  install -Dm644 ../openzone/doc/README.html ${pkgdir}/usr/share/doc/openzone/README.html
  install -Dm644 ../openzone/doc/PREBERI.html ${pkgdir}/usr/share/doc/openzone/PREBERI.html
}

package_openzone-data()
{
  pkgdesc='OpenZone game data'
  license=('CCPL:by-nc-sa')
  arch=('any')

  cd ${srcdir}/build

  install -Dm644 ${srcdir}/openzone.zip ${pkgdir}/usr/share/openzone/openzone.zip
}

package_openzone-doc()
{
  pkgdesc='OpenZone engine documentation'
  arch=('any')

  mkdir -p ${pkgdir}/usr/share/doc/openzone
  cp -r ${srcdir}/openzone/doc/doxygen/html ${pkgdir}/usr/share/doc/openzone/doxygen
}
